<% title "Sign up" %>

<%= bootstrap_devise_error_messages! %>
<div class="card">
  <div class="card-body">
    <h1 class="card-title"><%= t('.sign_up', default: 'Sign up') %></h1>
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { role: 'form' }) do |f| %>
      <div class="form-group">
        <%= f.label :username %>
        <%= f.text_field :username,
          autofocus: true,
          class: 'form-control',
          required: true,
          pattern: '[a-zA-Z0-9\-]{4,15}',
          title: "Must be between 4 and 15 characters. Only letters, numbers and hyphens allowed." %>
      </div>
      <div class="form-group">
        <%= f.label :email %>
        <%= f.email_field :email, class: 'form-control', required: true %>
      </div>
      <div class="form-group">
        <%= f.label :password %>
        <%= f.password_field :password, class: 'form-control', required: true, pattern: '.{8,128}' %>
      </div>
      <div class="form-group">
        <%= f.label :password_confirmation %>
        <%= f.password_field :password_confirmation, class: 'form-control', required: true, pattern: '.{8,128}' %>
      </div>
      <div class="form-group">
        <div class="form-check">
          <%= f.check_box :terms_of_service, class: "form-check-input", required: true %>
          <%= f.label :terms_of_service, class: "form-check-label" do %>
            I accept the <%= link_to 'terms of service', policies_terms_path %>.
          <% end %>
        </div>
      </div>

      <div class="form-group">
        <%= f.submit t('.sign_up', default: 'Sign up'), class: 'btn btn-primary' %>
      </div>
    <% end %>

    <%= render 'devise/shared/links' %>
  </div>
</div>
<script>
  var password, password_confirmation, validatePassword;

  password = document.getElementById('user_password');

  password_confirmation = document.getElementById('user_password_confirmation');

  validatePassword = function() {
    if (password.value !== password_confirmation.value) {
      password_confirmation.setCustomValidity("Please make sure your passwords match.");
    } else {
      password_confirmation.setCustomValidity('');
    }
  };

  password.onchange = validatePassword;

  password_confirmation.onkeyup = validatePassword;
</script>
